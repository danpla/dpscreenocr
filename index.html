<!DOCTYPE html>
<html>
<head>
<title>dpScreenOCR</title>
<meta charset="utf-8">
<script>
  // The code is intentionally written in ES5 JavaScript to support
  // old browsers.
  var langs = ["ca", "de", "en", "es", "ru", "uk"];

  var userLangFixups = {
    // Some browsers use no longer recommended zh-CN and zh-TW codes
    // for Simplified and Traditional Chinese. See:
    // https://www.w3.org/International/geo/html-tech/tech-lang.html
    "zh-CN": "zh-Hans",
    "zh-TW": "zh-Hant"
  };

  function startsWith(str, other) {
    return str.lastIndexOf(other, 0) == 0;
  }

  function detectPageLang() {
    var userLangs = navigator.languages || [navigator.language];
    // navigator.languages is immutable, so make a copy so that we can
    // remove elements later.
    userLangs = userLangs.slice();

    while (userLangs.length > 0) {
      console.log(userLangs);

      for (var i = 0; i < userLangs.length;) {
        var userLang = userLangs[i];
        userLang = userLangFixups[userLang] || userLang;

        for (var j = 0; j < langs.length; ++j) {
          var lang = langs[j];
          if (startsWith(lang, userLang))
            return lang;
        }

        // Trim the last tag for a more generic match.
        var hyphenIndex = userLang.lastIndexOf('-');
        if (hyphenIndex == -1)
          userLangs.splice(i, 1);
        else {
          userLangs[i] = userLang.substring(0, hyphenIndex);
          ++i;
        }
      }
    }

    return null;
  }

  var pageLang;

  // Access to localStorage may be disabled by the user, so guard it
  // with try-catch.
  try {
    pageLang = localStorage.getItem("lang");
  } catch {
  }

  pageLang = pageLang || detectPageLang() || "en";

  try {
    localStorage.setItem("lang", pageLang);
  } catch {
  }

  window.location.replace(pageLang + "/");
</script>
<noscript>
  <meta http-equiv="refresh" content="0; url='en/'">
</noscript>
</head>
<body>
<!--
A fallback for really weird browsers that support neither ES5 JS nor
<meta> redirect.
-->
<a href="en/">English</a>
</body>
</html>
